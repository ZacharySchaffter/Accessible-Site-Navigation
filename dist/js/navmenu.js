function findAncestor(e,t,s){for(;e=e.parentNode;){if(!e||!e.tagName)return null;if((!t||t==e.tagName.toLowerCase())&&(!s||0<=e.className.indexOf(s)))return e}}function addClass(e,t){-1==e.className.split(" ").indexOf(t)&&(e.className+=" "+t)}function removeClass(e,t){var s=e.className.split(" ");-1<s.indexOf(t)&&(s.splice(s.indexOf(t),1),e.className=s.join(" "))}function hasClass(e,t){return-1<e.className.split(" ").indexOf(t)}var MenuBar=function(e){this.domNode=document.getElementById(e),this.isMenuBar=!0,this.menuitems=[]};MenuBar.prototype.init=function(){this.domNode.setAttribute("role","menubar");for(var e=this.domNode.firstElementChild;e;){if(e.firstElementChild&&"a"===e.firstElementChild.nodeName.toLowerCase()){var t=new MenuItem(e.firstElementChild,this);t.init(),this.menuitems.push(t)}e=e.nextElementSibling}var s=this;document.addEventListener("mousedown",function(e){s.domNode.contains(e.target)||s.closeAll()})},MenuBar.prototype.closeAll=function(){this.menuitems.forEach(function(e){e.subMenu.close("true")})},MenuBar.prototype.setFocusToNext=function(e){var t,s;e!==this.menuitems[this.menuitems.length-1]&&(t=this.menuitems.indexOf(e),s=this.menuitems[t+1],this.setFocusToItem(s))},MenuBar.prototype.setFocusToPrev=function(e){var t=this.menuitems.indexOf(e);if(0!==t){var s=this.menuitems[t-1];this.setFocusToItem(s)}},MenuBar.prototype.setFocusToItem=function(e){for(var t=!1,s=0;s<this.menuitems.length;s++){t="true"===this.menuitems[s].domNode.getAttribute("aria-expanded"),e.domNode.focus(),t&&e.subMenu&&e.subMenu.open()}};var MenuItem=function(e,t,s){this.menu=t,this.domNode=e,this.subMenu=!1,this.isMobileMenuItem=s,this.keyCode=Object.freeze({TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40})};MenuItem.prototype.init=function(){this.domNode.setAttribute("role","menuitem"),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("click",this.handleClick.bind(this)),this.isMobileMenuItem||(this.domNode.addEventListener("touchstart",this.handleTouch.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this)));var e=this.domNode.nextElementSibling;e&&"UL"===e.tagName&&(this.domNode.setAttribute("aria-haspopup","true"),this.domNode.setAttribute("aria-expanded","false"),addClass(this.domNode,"has-children"),this.subMenu=new SubMenu(e,this),this.subMenu.init())},MenuItem.prototype.handleClick=function(e){console.log("Click Event"),e.stopPropagation(),!hasClass(e.target,"active")&&this.subMenu?(e.preventDefault(),this.subMenu.open(!0)):!hasClass(e.target,"active")||"#"!==e.target.getAttribute("href")&&e.target.getAttribute("href")||(e.preventDefault(),this.subMenu.close(!0))},MenuItem.prototype.handleTouch=function(e){console.log("Touched"),this.isTouched=!0},MenuItem.prototype.handleKeydown=function(e){e.currentTarget;var t=!1;switch(e.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:!hasClass(this.domNode,"active")&&this.subMenu&&(this.subMenu.open(close),this.subMenu.setFocusToFirstItem(),t=!0);break;case this.keyCode.DOWN:this.menu.isMenuBar&&!this.isMobileMenuItem?(this.subMenu.open(!0),this.subMenu.setFocusToFirstItem()):this.menu.setFocusToNext(this),t=!0,!this.menu.isMenuBar&&this.subMenu&&this.subMenu.close();break;case this.keyCode.LEFT:this.menu.isMenuBar&&!this.isMobileMenuItem?(this.menu.setFocusToPrev(this),this.subMenu.close()):this.menu.parentMenuItem.menu.isMenuBar||(this.menu.setFocusToParent(),this.menu.close()),t=!0;break;case this.keyCode.RIGHT:this.menu.isMenuBar&&!this.isMobileMenuItem?(this.menu.setFocusToNext(this),this.subMenu.close()):this.subMenu&&(this.subMenu.open(!0),this.subMenu.setFocusToFirstItem()),t=!0;break;case this.keyCode.UP:this.menu.menuitems&&0===this.menu.menuitems.indexOf(this)&&this.menu.parentMenuItem.menu.isMenuBar?(this.menu.close(),this.menu.parentMenuItem.domNode.focus()):this.menu.setFocusToPrev(this),!this.menu.isMenuBar&&this.subMenu&&this.subMenu.close(),t=!0;break;case this.keyCode.ESC:this.menu.close(),this.menu.parentMenuItem.domNode.focus(),t=!0;break;case e.shiftKey&&this.keyCode.TAB:this.menu.menuitems&&0===this.menu.menuitems.indexOf(this)&&this.menu.parentMenuItem?(this.menu.close(),this.menu.parentMenuItem.domNode.focus(),t=!0):this.menu.isMenuBar||(this.menu.setFocusToPrev(this),t=!0);break;case this.keyCode.TAB:console.log(this),this.menu.isMenuBar||(this.menu.setFocusToNext(this),t=!0);break;case this.keyCode.END:case this.keyCode.PAGEDOWN:t=!0}t&&(e.stopPropagation(),e.preventDefault())},MenuItem.prototype.setExpanded=function(e){this.domNode.setAttribute("aria-expanded",e)},MenuItem.prototype.handleMouseover=function(e){if(this.hasHover=!0,this.isTouched)this.isTouched=!1;else{var s=this;setTimeout(function(){if(s.hasHover){for(var e=s.menu.parentMenuItem;e;)addClass(e.domNode,"active"),e=!!e.menu&&e.menu.parentMenuItem;var t=s;s.menu.menuitems.forEach(function(e){t!=e&&e.subMenu&&e.subMenu.close(!0)}),addClass(s.domNode,"active"),s.subMenu&&s.subMenu.open()}},15)}},MenuItem.prototype.handleMouseout=function(e){this.hasHover=!1,removeClass(this.domNode,"active")},MenuItem.prototype.checkIfCurrentLink=function(e){var t=this.domNode.getAttribute("href");if("/"===t.slice(-1)&&(t+="index.shtml"),e!==t&&!this.subMenu)return!1;if(e!==t&&this.subMenu){for(var s=!1,n=0;n<this.subMenu.menuitems.length;n++){if(s=this.subMenu.menuitems[n].checkIfCurrentLink(e))break}return s}if(0<=e.indexOf(t)){if(addClass(this.domNode,"current-menu-item"),this.isMobileMenuItem){addClass(this.domNode,"active");for(var i=!!this.menu.parentMenuItem&&this.menu.parentMenuItem;i;)this.menu.open(),console.log(this.menu),addClass(i.domNode,"active"),i=!!i.menu.parentMenuItem&&i.menu.parentMenuItem}return!0}};var SubMenu=function(e,t){this.isMenuBar=!1,this.domNode=e,this.parentMenuItem=t,this.isVisible=!1,this.menuitems=[]};SubMenu.prototype.init=function(){var e,t;for(this.domNode.setAttribute("role","menu"),this.parentMenuItem.isMobileMenuItem||(this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this))),e=this.domNode.firstElementChild;e;){if((t=e.firstElementChild)&&"a"==t.tagName.toLowerCase()){var s=new MenuItem(t,this,this.parentMenuItem.isMobileMenuItem);s.init(),this.menuitems.push(s)}e=e.nextElementSibling}},SubMenu.prototype.handleMouseover=function(e){this.hasHover=!0,this.open()},SubMenu.prototype.handleMouseout=function(e){this.hasHover=!1;var t=this,s=this.parentMenuItem;setTimeout(function(){t.hasHover||s.hasHover||t.close(!0)},200)},SubMenu.prototype.open=function(e){if(addClass(this.parentMenuItem.domNode,"active"),this.parentMenuItem.setExpanded(!0),this.isVisible=!0,e){var t=this.parentMenuItem;this.parentMenuItem.menu.menuitems.forEach(function(e){t!=e&&e.subMenu&&e.subMenu.close(!0)})}},SubMenu.prototype.close=function(e){removeClass(this.parentMenuItem.domNode,"active"),this.parentMenuItem.setExpanded(!1),this.isVisible=!1,e&&this.menuitems.forEach(function(e){removeClass(e.domNode,"active"),e.subMenu&&e.subMenu.close(!0)})},SubMenu.prototype.setFocusToItem=function(e){for(var t=!1,s=0;s<this.menuitems.length;s++){t="true"===this.menuitems[s].domNode.getAttribute("aria-expanded"),e.domNode.focus(),t&&e.subMenu&&e.subMenu.open()}},SubMenu.prototype.setFocusToFirstItem=function(){this.menuitems[0].domNode.focus()},SubMenu.prototype.setFocusToParent=function(){this.parentMenuItem&&this.parentMenuItem.domNode.focus()},SubMenu.prototype.setFocusToNext=function(e){var t,s;e!==this.menuitems[this.menuitems.length-1]&&(t=this.menuitems.indexOf(e),s=this.menuitems[t+1],this.setFocusToItem(s))},SubMenu.prototype.setFocusToPrev=function(e){var t=this.menuitems.indexOf(e);if(0!==t){var s=this.menuitems[t-1];this.setFocusToItem(s)}};var menu=new MenuBar("main-navigation");menu.init();
function findAncestor(e,t,s){for(;e=e.parentNode;){if(!e||!e.tagName)return null;if((!t||t==e.tagName.toLowerCase())&&(!s||0<=e.className.indexOf(s)))return e}}function addClass(e,t){-1==e.className.split(" ").indexOf(t)&&(e.className+=" "+t)}function removeClass(e,t){var s=e.className.split(" ");-1<s.indexOf(t)&&(s.splice(s.indexOf(t),1),e.className=s.join(" "))}function hasClass(e,t){return-1<e.className.split(" ").indexOf(t)}var MenuBar=function(e){this.domNode=document.getElementById(e),this.isMenuBar=!0,this.menuitems=[]};MenuBar.prototype.init=function(){this.domNode.setAttribute("role","menubar");for(var e=this.domNode.firstElementChild;e;){if(e){var t=new MenuItem(e,this);t.init(),this.menuitems.push(t)}e=e.nextElementSibling}},MenuBar.prototype.setFocusToNext=function(e){var t,s;e!==this.menuitems[this.menuitems.length-1]&&(t=this.menuitems.indexOf(e),s=this.menuitems[t+1],this.setFocusToItem(s))},MenuBar.prototype.setFocusToPrev=function(e){var t=this.menuitems.indexOf(e);if(0!==t){var s=this.menuitems[t-1];this.setFocusToItem(s)}},MenuBar.prototype.setFocusToItem=function(e){for(var t=!1,s=0;s<this.menuitems.length;s++){t="true"===this.menuitems[s].domNode.getAttribute("aria-expanded"),e.domNode.focus(),t&&e.subMenu&&e.subMenu.open()}};var MenuItem=function(e,t){this.menu=t,this.domNode=e,this.subMenu=!1,this.keyCode=Object.freeze({TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40})};MenuItem.prototype.init=function(){var e;this.domNode.setAttribute("role","menuitem"),this.domNode.addEventListener("keydown",this.handleKeydown.bind(this)),this.domNode.addEventListener("touchstart",this.handleTouch.bind(this)),this.domNode.addEventListener("focus",this.handleFocus.bind(this)),this.domNode.addEventListener("blur",this.handleBlur.bind(this)),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this)),this.menu.isMenuBar?(e=this.domNode.firstElementChild)&&"UL"===e.tagName&&(this.domNode.setAttribute("aria-haspopup","true"),addClass(this.domNode,"has-children"),this.subMenu=new SubMenu(e,this),this.subMenu.init()):(e=this.domNode.nextElementSibling)&&"UL"===e.tagName&&(this.domNode.setAttribute("aria-haspopup","true"),addClass(this.domNode,"has-children"),this.subMenu=new SubMenu(e,this),this.subMenu.init())},MenuItem.prototype.handleTouch=function(e){if(console.log("Touch detected"),e.stopPropagation(),!hasClass(e.target,"active")&&this.subMenu){console.log("El wasnt active and has submenu"),e.preventDefault(),addClass(this.domNode,"active");var t=this;this.menu.menuitems.forEach(function(e){t!==e&&e.subMenu&&e.subMenu.close()}),this.subMenu.open(!0)}console.log("------------")},MenuItem.prototype.handleKeydown=function(e){e.currentTarget,e.key;var t=!1;switch(e.keyCode){case this.keyCode.SPACE:!hasClass(this.domNode,"active")&&this.subMenu&&(this.subMenu.open(),this.subMenu.setFocusToFirstItem(),t=!0);break;case this.keyCode.DOWN:this.menu.isMenuBar?(this.subMenu.open(),this.subMenu.setFocusToFirstItem()):this.menu.setFocusToNext(this),t=!0;break;case this.keyCode.LEFT:this.menu.isMenuBar?(this.menu.setFocusToPrev(this),this.subMenu.close()):this.menu.parentMenuItem.menu.isMenuBar||(this.menu.setFocusToParent(),this.menu.close()),t=!0;break;case this.keyCode.RIGHT:this.menu.isMenuBar?(this.menu.setFocusToNext(this),this.subMenu.close()):this.subMenu&&(this.subMenu.open(),this.subMenu.setFocusToFirstItem()),t=!0;break;case this.keyCode.UP:this.menu.menuitems&&0===this.menu.menuitems.indexOf(this)&&this.menu.parentMenuItem.menu.isMenuBar?(this.menu.close(),this.menu.parentMenuItem.domNode.focus()):this.menu.setFocusToPrev(this),t=!0;break;case this.keyCode.ESC:this.menu.close(),this.menu.parentMenuItem.domNode.focus(),t=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:t=!0;break;case this.keyCode.TAB:this.subMenu.close()}t&&(e.stopPropagation(),e.preventDefault())},MenuItem.prototype.setExpanded=function(e){this.domNode.setAttribute("aria-expanded",e)},MenuItem.prototype.handleFocus=function(e){},MenuItem.prototype.handleBlur=function(e){},MenuItem.prototype.handleMouseover=function(e){addClass(this.domNode,"active");for(var t=this.menu.parentMenuItem;t;)addClass(t.domNode,"active"),t=!!t.menu&&t.menu.parentMenuItem;var s=this;this.menu.menuitems.forEach(function(e){s!=e&&e.subMenu&&e.subMenu.close(!0)}),this.subMenu&&this.subMenu.open()},MenuItem.prototype.handleMouseout=function(e){removeClass(this.domNode,"active")};var SubMenu=function(e,t){this.isMenuBar=!1,this.domNode=e,this.parentMenuItem=t,this.isVisible=!1,this.menuitems=[]};SubMenu.prototype.init=function(){var e,t;for(this.domNode.setAttribute("role","menu"),this.domNode.addEventListener("mouseover",this.handleMouseover.bind(this)),this.domNode.addEventListener("mouseout",this.handleMouseout.bind(this)),e=this.domNode.firstElementChild;e;){if((t=e.firstElementChild)&&"a"==t.tagName.toLowerCase()){var s=new MenuItem(t,this);s.init(),this.menuitems.push(s)}e=e.nextElementSibling}},SubMenu.prototype.handleMouseover=function(e){this.open()},SubMenu.prototype.handleMouseout=function(e){this.close(!0)},SubMenu.prototype.open=function(e){addClass(this.parentMenuItem.domNode,"active"),this.parentMenuItem.setExpanded(!0),this.isVisible=!0},SubMenu.prototype.close=function(e){removeClass(this.parentMenuItem.domNode,"active"),this.parentMenuItem.setExpanded(!1),this.isVisible=!1},SubMenu.prototype.setFocusToItem=function(e){for(var t=!1,s=0;s<this.menuitems.length;s++){t="true"===this.menuitems[s].domNode.getAttribute("aria-expanded"),e.domNode.focus(),t&&e.subMenu&&e.subMenu.open()}},SubMenu.prototype.setFocusToFirstItem=function(){this.menuitems[0].domNode.focus()},SubMenu.prototype.setFocusToParent=function(){this.parentMenuItem&&this.parentMenuItem.domNode.focus()},SubMenu.prototype.setFocusToNext=function(e){var t,s;e!==this.menuitems[this.menuitems.length-1]&&(t=this.menuitems.indexOf(e),s=this.menuitems[t+1],this.setFocusToItem(s))},SubMenu.prototype.setFocusToPrev=function(e){var t=this.menuitems.indexOf(e);if(0!==t){var s=this.menuitems[t-1];this.setFocusToItem(s)}};var menu=new MenuBar("main-navigation");menu.init();